<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .jumbotron {
          padding: 20px;
          margin-bottom: 20px;
          background-color: #e9ecef;
        }
#search-results {
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 5px; 
    max-height: 300px; 
    overflow-y: auto;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

#search-results div {
    display: flex;
    align-items: center; 
    padding: 10px; 
    border-bottom: 1px solid #eee;
    transition: background-color 0.3s;
}

#search-results div:hover {
    background-color: #f0f0f0;
}

#search-results div a {
    text-decoration: none;
    color: #333; 
    font-size: 14px;
    font-weight: bold;
    margin-left: 10px;
    display: flex; 
    flex-direction: column;
}

#search-results div a:hover {
    color: #007bff;
}

#search-results div img {
    width: 50px; 
    height: 50px;
    object-fit: cover;
    border-radius: 5px;
    border: 1px solid #ddd;
}

    </style>
    {% block extra_header %}{% endblock extra_header %}
    <title>Movie Review website | {% block title %}{% endblock title %}</title>
    
</head>
<body>
    
    {% include 'inc/navbar.html' %}
    <div class="jumbotron">
        {% include 'inc/messages.html' %}
        {% block content %}{% endblock content %}
    </div>
<script>
  document.getElementById('search-input').addEventListener('input', function() {
  const query = this.value.trim();
  const resultsContainer = document.getElementById('search-results');
  resultsContainer.innerHTML = '';

  if (query === '') return;

  fetch(`/search/?q=${encodeURIComponent(query)}`)
    .then(response => response.json())
    .then(data => {
      const { movies, actors } = data;

      if (movies.length === 0 && actors.length === 0) {
        resultsContainer.innerHTML = '<li class="dropdown-item text-muted">نتیجه‌ای پیدا نشد.</li>';
        return;
      }

      if (movies.length > 0) {
        const movieHeader = document.createElement('li');
        movieHeader.className = 'dropdown-header text-primary';
        movieHeader.textContent = 'فیلم‌ها';
        resultsContainer.appendChild(movieHeader);

        movies.forEach(movie => {
          const li = document.createElement('li');
          li.className = 'dropdown-item d-flex align-items-center';
          li.innerHTML = `
            <img src="${movie.poster_url}" alt="${movie.name_fa}" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; margin-right: 10px;">
            <div>
              <a href="/movie/${movie.id}/" class="text-dark text-decoration-none">
                <strong>${movie.name_fa}</strong> <span class="text-muted">(${movie.name_en})</span>
              </a>
              <p class="mb-0 text-muted" style="font-size: 0.8rem;">تاریخ انتشار: ${movie.release_date}</p>
            </div>
          `;
          resultsContainer.appendChild(li);
        });
      }

      if (actors.length > 0) {
        const actorHeader = document.createElement('li');
        actorHeader.className = 'dropdown-header text-primary';
        actorHeader.textContent = 'بازیگران';
        resultsContainer.appendChild(actorHeader);

        actors.forEach(actor => {
          const li = document.createElement('li');
          li.className = 'dropdown-item d-flex align-items-center';
          li.innerHTML = `
            <img src="${actor.photo_url}" alt="${actor.name_fa}" style="width: 40px; height: 40px; object-fit: cover; border-radius: 50%; margin-right: 10px;">
            <div>
              <a href="/actor/Roles/${actor.id}/" class="text-dark text-decoration-none">
                <strong>${actor.name_fa}</strong> <span class="text-muted">(${actor.name_en})</span>
              </a>
            </div>
          `;
          resultsContainer.appendChild(li);
        });
      }
    })
    .catch(error => {
      console.error('Error:', error);
      resultsContainer.innerHTML = '<li class="dropdown-item text-danger">خطا در جستجو!</li>';
    });

  resultsContainer.classList.add('show');
});

document.addEventListener('click', function(event) {
  const resultsContainer = document.getElementById('search-results');
  if (!event.target.closest('#search-form')) {
    resultsContainer.classList.remove('show');
  }
});
</script>
</body>
</html>